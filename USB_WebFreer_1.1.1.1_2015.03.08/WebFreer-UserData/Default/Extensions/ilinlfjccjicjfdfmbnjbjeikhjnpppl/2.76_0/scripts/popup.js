function initialize(a,b,c){var d;if(a===view){b="act"}$("#tracks").empty();$("#notification").empty();chrome.extension.sendRequest({requestlist:"playview"},function(e){if(a==="startup"){view=e.sendlist;looking=e.sendlist;d=e.sendlist;chrome.extension.sendRequest({requestlist:"loopStatus"},function(a){$("#loop").text("Loop "+a.sendlist.substr(0,1).toUpperCase()+a.sendlist.substr(1,a.sendlist.length));if(a.sendlist!=="off"){$("#loop").addClass("on")}loopButton()});if(view==="inc"){$("#inc").addClass("selected")}else if(view==="fav"){$("#fav").addClass("selected")}else{chrome.extension.sendRequest({requestlist:"getproper"},function(a){$('<a href="#" id="'+view+'" class="selected">'+a.sendlist+"</a>").appendTo("#tabs")})}}else{d=a}chrome.extension.sendRequest({requestlist:"current"},function(e){playing=e.sendlist;chrome.extension.sendRequest({requestlist:"give,"+a},function(a){if(a.sendlist&&a.sendlist.length>0){for(i=0;i<a.sendlist.length;i++){var e;if(i%2===0){e="even"}else{e="odd"}$('<li class="'+e+'">'+(i+1)+". "+a.sendlist[i]+"</li>").appendTo("#tracks")}if(a.sendlist.length%2===0){e="even"}else{e="odd"}$('<li id="moreTracks" class="'+e+'"><a href="#">Load More Tracks</a></li>').appendTo("#tracks");$("#moreTracks").click(function(){loadMore()});actions(playing,d,b);if(d==="fav"){if(c==="add"){$("#tracks").scrollTop(lastPosf*17)}lastPosf=i}else if(d==="inc"){if(c==="add"){$("#tracks").scrollTop(lastPosi*17)}lastPosi=i}else{if(c==="add"){$("#tracks").scrollTop(lastPosm*17)}lastPosm=i}}else if(c==="add"){$('<li class="loading">Loading artist tracks...</li>').appendTo("#tracks")}else{$("#tracklist").hide();$("#tabs").hide();$("#loop").hide();$('<div id="setup"><h1>No SoundCloud Data Available</h1><p>If you haven\'t set up the SoundCloud Latest Tracks for Chrome extension then <a href="options.html" target="_new">do that now</a>.</p><p>If you\'ve already completed the setup then double check and make sure your application token is correct. If your token is correct then there is a problem communicating with SoundCloud\'s server right now. Try opening this extension again later.</p></div>').appendTo("#track");chrome.extension.sendRequest({requestlist:"reset"})}})})});linkTabs()}function actions(a,b,c){child=parseInt(a,10)+1;$("#tracks").show();$("#comment").hide();if(view===looking&&c==="next"){c="act"}if(view!==looking&&c==="next"){chrome.extension.sendRequest({requestlist:"datastring"},function(a){var c=a.sendlist;$("#access").empty();$(c).appendTo("#access");generateTrack("#access a",b,0,1)})}if(c==="act"){generateTrack("ol li:nth-child("+child+") a",b)}$(".tLink").click(function(){child=$("ol li a").index($(this))+1;view=b;generateTrack(this,b,1)})}function generateTrack(a,b,c,d){$("li").removeClass("active");$("#track").empty();playing=$(a).text();var e=$(a).attr("id").split(",");var f=e[2].replace("large","badge");if(f==="null"){f="images/nobadge.png"}var g='<a href="#" class="remfav" id="removeFavorite">Remove from favorites</a><a href="#" class="addfav" id="saveFavorite">Save to favorites</a>';if(e[3]!=="undefined"){g=g+'<a href="'+e[3]+'?client_id=2b161e5544f1f7f4cab5ff3c76c6c7b8" target="_new" class="download">Download</a>'}if(e[4]!=="null"){g=g+'<a href="'+e[4]+'" target="_new" class="purchase">Purchase</a>'}if(e[5]!==""){g=g+'<div class="genre"><a href="http://soundcloud.com/tags/'+e[5]+'" target="_new">'+e[5]+"</a></div>"}$('<div id="tInfo"><img src="'+f+'" alt="" class="badge"/><h3 id="title"><a href="'+e[1]+'" target="_new">'+$(a).text().substr(0,$(a).text().length-4-e[8].length)+'</a> by <a href="'+e[7]+'" id="artist">'+e[8]+"</a></h3></div>").appendTo("#track");if($("#title").height()<=23){$("#title").css("margin-top","12px")}$('<div id="actions">'+g+'</div><div id="player"><div class="playPauseC"><a href="#" id="playPause" class="play"></a></div><div id="time">0.00 / 0.00</div><div id="waveform"><div id="buffering"></div><img src="'+e[0]+'" unselectable="on" class="wavebg"/><div id="progress"><img src="images/progress.png" unselectable="on"/></div></div><a href="#" id="comments" class="hide"></a></div>').appendTo("#track");if(!d){$("ol li:nth-child("+child+")").addClass("active")}if(c){chrome.extension.sendRequest({requestlist:"changetracks,"+b+","+(child-1)})}$("#artist").click(function(a){a.preventDefault();commentReset();$("#tabs > a").removeClass("selected");if($("#tabs a:nth-child(3)")){$("#tabs a:nth-child(3)").remove()}$('<a href="#" id="'+$(this).attr("href")+'" class="selected">'+$(this).text()+"</a>").appendTo("#tabs");initialize($(this).attr("href"),"look","add");looking=$(this).attr("href");linkTabs();chrome.extension.sendRequest({requestlist:"proper,"+$(this).text()})});generateController(e[6]);chrome.extension.sendRequest({requestlist:"forceshift"})}function generateController(a){$("#playPause").click(function(){chrome.extension.sendRequest({requestlist:"playback"});chrome.extension.sendRequest({requestlist:"forceshift"})});$("#waveform").click(function(a){var b=$("#waveform").offset();var c=a.pageX-b.left;chrome.extension.sendRequest({requestlist:"scrub,"+c})});if(a==="true"){$("#comments").show();$("#comments").click(function(){if($("#comments").hasClass("hide")){$("#comments").removeClass("hide");$("#comments").addClass("show");$("#comment").show();$("#tracks").hide()}else{$("#comments").removeClass("show");$("#comments").addClass("hide");$("#tracks").show();$("#comment").hide()}})}else{$("#comments").hide()}chrome.extension.sendRequest({requestlist:"favinfo"},function(a){var b=a.sendlist;if(b){$("#removeFavorite").show();$("#saveFavorite").hide()}else{$("#saveFavorite").show();$("#removeFavorite").hide()}});$("#saveFavorite").click(function(){$("#removeFavorite").show();$("#saveFavorite").hide();chrome.extension.sendRequest({requestlist:"saveFavorite"})});$("#removeFavorite").click(function(){$("#saveFavorite").show();$("#removeFavorite").hide();chrome.extension.sendRequest({requestlist:"removeFavorite"})});initialized=true;fetchComments()}function fetchComments(){$("#comment").empty();chrome.extension.sendRequest({requestlist:"comments"},function(a){if(a.sendlist!==""){$("#comment").html(a.sendlist);$("#postcomment").click(function(){if($("#newcomment").val()!==""){chrome.extension.sendRequest({requestlist:"postcomment,"+$("#newcomment").val()},function(a){fetchComments()})}})}})}function loadMore(){chrome.extension.sendRequest({requestlist:"loadmore"+looking})}function loopButton(){$("#loop").click(function(a){a.preventDefault();if($(this).text()==="Loop Off"){$(this).text("Loop All");$(this).addClass("on");chrome.extension.sendRequest({requestlist:"loopAll"})}else if($(this).text()==="Loop All"){$(this).text("Loop One");chrome.extension.sendRequest({requestlist:"loopOne"})}else{$(this).text("Loop Off");$(this).removeClass();chrome.extension.sendRequest({requestlist:"loopNone"})}})}function linkTabs(){$("#tabs > a").click(function(a){a.preventDefault();if(!$(this).hasClass("selected")){commentReset();$("#tabs > a").removeClass("selected");$(this).addClass("selected");initialize(this.id,"look");looking=this.id;lastPosi=0;lastPosf=0;lastPosm=0}})}function commentReset(){if($("#comments").hasClass("show")){$("#comments").removeClass("show");$("#comments").addClass("hide")}}var playing,child,view="inc",initialized=false,looking="inc",i,lastPosf=0,lastPosi=0,lastPosm=0;$(function(){initialize("startup","act")});chrome.extension.onRequest.addListener(function(a,b,c){if(initialized===true){var d;if(a.requestlist==="new"){initialize("startup","act");c({})}else if(a.requestlist.substring(0,6)==="buffer"){d=a.requestlist.split(",");$("#buffering").width(d[1]);$("#progress").width(d[2]);$("#time").html(d[3]);c({})}else if(a.requestlist.substring(0,9)==="playstate"){d=a.requestlist.split(",");$("#playPause").removeClass("pause play");$("#playPause").addClass(d[1]);c({})}else if(a.requestlist.substring(0,4)==="next"){d=a.requestlist.split(",");actions(d[1],view,"next");c({})}else if(a.requestlist.substr(0,9)==="readymore"){if(a.requestlist.substr(9)==="fav"){initialize("fav","look","add")}else if(a.requestlist.substr(9)==="inc"){initialize("inc","look","add")}else{initialize($("#tabs a:nth-child(3)").attr("id"),"look","add")}}else{c({})}}else{c({})}})